<?php

namespace CatTearsBot\Commands;

use Longman\TelegramBot\Commands\UserCommand;
use Longman\TelegramBot\Entities\ServerResponse;
use Longman\TelegramBot\Entities\Keyboard;
use Longman\TelegramBot\Exception\TelegramException;

/**
 * ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
 */
class SupportCommand extends UserCommand
{
    /**
     * @var string
     */
    protected $name = 'support';

    /**
     * @var string
     */
    protected $description = 'Ð‘Ð¾Ñ‚ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸ Ð´Ð»Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸ Ð² Ñ‚Ñ€ÑƒÐ´Ð½Ñ‹Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹';

    /**
     * @var string
     */
    protected $usage = '/support';

    /**
     * @var string
     */
    protected $version = '1.0.0';
    
    /**
     * ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÑŽÑ‰Ð¸Ðµ Ñ„Ñ€Ð°Ð·Ñ‹
     * @var array
     */
    private $support_messages = [
        "Ð¢Ñ‹ Ð½Ðµ Ð¾Ð´Ð½Ð°, Ñ Ð·Ð´ÐµÑÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ Ñ‚ÐµÐ±Ðµ. ðŸ’–",
        "Ð¢Ñ‹ ÑÐ¸Ð»ÑŒÐ½Ð°Ñ, Ð¸ Ñƒ Ñ‚ÐµÐ±Ñ Ð²ÑÑ‘ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑÑ. ðŸŒ¸",
        "Ð”Ð°Ð²Ð°Ð¹ ÑÐ´ÐµÐ»Ð°ÐµÐ¼ Ð³Ð»ÑƒÐ±Ð¾ÐºÐ¸Ð¹ Ð²Ð´Ð¾Ñ…... Ð¢Ñ‹ ÑÐ¿Ñ€Ð°Ð²Ð¸ÑˆÑŒÑÑ! ðŸ’«",
        "Ð¢Ñ‹ Ð·Ð°ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°ÐµÑˆÑŒ Ð·Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¸ Ð»ÑŽÐ±Ð²Ð¸. ÐÐµ Ð·Ð°Ð±Ñ‹Ð²Ð°Ð¹ Ð¾Ð± ÑÑ‚Ð¾Ð¼. ðŸŒ¼",
        "Ð˜Ð½Ð¾Ð³Ð´Ð° Ð½ÑƒÐ¶Ð½Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð²Ñ‹Ð´Ð¾Ñ…Ð½ÑƒÑ‚ÑŒ. Ð¯ Ñ€ÑÐ´Ð¾Ð¼. ðŸ’•",
    ];
    
    /**
     * Ð¡Ð¾Ð²ÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÐ°Ð¼Ð¾Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸
     * @var array
     */
    private $self_help_tips = [
        "ðŸ”¹ ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹ Ð²ÐµÑÑ‚Ð¸ Ð´Ð½ÐµÐ²Ð½Ð¸Ðº: Ð·Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°Ð¹ ÑÐ²Ð¾Ð¸ Ð¼Ñ‹ÑÐ»Ð¸ Ð¸ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð°.",
        "ðŸ”¹ Ð’Ñ‹Ð´ÐµÐ»Ð¸ 10 Ð¼Ð¸Ð½ÑƒÑ‚ Ð½Ð° Ð¼ÐµÐ´Ð¸Ñ‚Ð°Ñ†Ð¸ÑŽ Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ñ‚Ð¸ÑˆÐ¸Ð½Ñƒ.",
        "ðŸ”¹ Ð¡Ð´ÐµÐ»Ð°Ð¹ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð¾Ðµ Ð´Ð»Ñ ÑÐµÐ±Ñ: Ñ‡Ð°Ð¹, ÐºÐ½Ð¸Ð³Ð°, Ñ‚ÐµÐ¿Ð»Ñ‹Ð¹ Ð¿Ð»ÐµÐ´.",
        "ðŸ”¹ ÐŸÐ¾Ð·Ð²Ð¾Ð½Ð¸ Ð±Ð»Ð¸Ð·ÐºÐ¾Ð¼Ñƒ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÑƒ Ð¸ Ð¿Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¸ Ð¾ ÑÐ²Ð¾Ð¸Ñ… Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸ÑÑ….",
        "ðŸ”¹ ÐŸÑ€Ð¾Ð¹Ð´Ð¸ÑÑŒ Ð½Ð° ÑÐ²ÐµÐ¶ÐµÐ¼ Ð²Ð¾Ð·Ð´ÑƒÑ…Ðµ, Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ Ð²ÑÐµÐ³Ð¾ 5 Ð¼Ð¸Ð½ÑƒÑ‚.",
    ];
    
    /**
     * Ð”Ñ‹Ñ…Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ñ
     * @var array
     */
    private $breathing_exercises = [
        "ðŸŒ¬ 4-7-8 Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ðµ: Ð’Ð´Ð¾Ñ… Ð½Ð° 4 ÑÐµÐº â†’ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ° Ð½Ð° 7 ÑÐµÐº â†’ Ð²Ñ‹Ð´Ð¾Ñ… Ð½Ð° 8 ÑÐµÐº. ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸ 3 Ñ€Ð°Ð·Ð°.",
        "ðŸŒ¿ Ð“Ð»ÑƒÐ±Ð¾ÐºÐ¾Ðµ Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ðµ: ÐœÐµÐ´Ð»ÐµÐ½Ð½Ð¾ Ð²Ð´Ð¾Ñ…Ð½Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð½Ð¾Ñ, Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ° 2 ÑÐµÐº, Ð²Ñ‹Ð´Ð¾Ñ… Ñ‡ÐµÑ€ÐµÐ· Ñ€Ð¾Ñ‚. 5 Ñ€Ð°Ð·.",
        "ðŸŒ¸ ÐšÐ²Ð°Ð´Ñ€Ð°Ñ‚Ð½Ð¾Ðµ Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ðµ: Ð’Ð´Ð¾Ñ… 4 ÑÐµÐº â†’ Ð¿Ð°ÑƒÐ·Ð° 4 ÑÐµÐº â†’ Ð²Ñ‹Ð´Ð¾Ñ… 4 ÑÐµÐº â†’ Ð¿Ð°ÑƒÐ·Ð° 4 ÑÐµÐº. 3 Ñ†Ð¸ÐºÐ»Ð°.",
    ];

    /**
     * Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹
     *
     * @return ServerResponse
     * @throws TelegramException
     */
    public function execute(): ServerResponse
    {
        $message = $this->getMessage();
        $chat_id = $message->getChat()->getId();
        $text = $message->getText(true);
        
        // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñƒ Ñ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ð¼Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼Ð¸
        $keyboard = new Keyboard(
            ['ðŸ’¬ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°'],
            ['ðŸ§˜â€â™€ï¸ Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ñ Ð´Ð»Ñ ÑƒÑÐ¿Ð¾ÐºÐ¾ÐµÐ½Ð¸Ñ'],
            ['ðŸ“š Ð¡Ð¾Ð²ÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÐ°Ð¼Ð¾Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸'],
            ['ðŸ†˜ Ð¡Ñ€Ð¾Ñ‡Ð½Ð°Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒ']
        );
        $keyboard->setResizeKeyboard(true);
        
        // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ñ‚ÐµÐºÑÑ‚Ð° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
        if ($text === 'ðŸ’¬ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°') {
            $response = $this->support_messages[array_rand($this->support_messages)];
        } elseif ($text === 'ðŸ§˜â€â™€ï¸ Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ñ Ð´Ð»Ñ ÑƒÑÐ¿Ð¾ÐºÐ¾ÐµÐ½Ð¸Ñ') {
            $response = $this->breathing_exercises[array_rand($this->breathing_exercises)];
        } elseif ($text === 'ðŸ“š Ð¡Ð¾Ð²ÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÐ°Ð¼Ð¾Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸') {
            // Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ 3 ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ñ… ÑÐ¾Ð²ÐµÑ‚Ð°
            $keys = array_rand($this->self_help_tips, 3);
            $selected_tips = [];
            foreach ($keys as $key) {
                $selected_tips[] = $this->self_help_tips[$key];
            }
            $response = implode("\n", $selected_tips);
        } elseif ($text === 'ðŸ†˜ Ð¡Ñ€Ð¾Ñ‡Ð½Ð°Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒ') {
            $response = "Ð•ÑÐ»Ð¸ Ñ‚ÐµÐ±Ðµ Ð¾Ñ‡ÐµÐ½ÑŒ Ñ‚ÑÐ¶ÐµÐ»Ð¾, Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¾Ð±Ñ€Ð°Ñ‚Ð¸ÑÑŒ Ð·Ð° Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ:\n"
                . "ðŸ“ž Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½ Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ: 8-800-2000-122 (ÐºÑ€ÑƒÐ³Ð»Ð¾ÑÑƒÑ‚Ð¾Ñ‡Ð½Ð¾)\n"
                . "âœ‰ï¸ Ð§Ð°Ñ‚ Ð¿ÑÐ¸Ñ…Ð¾Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸: https://www.psychologies.ru/";
        } else {
            // ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¸Ð»Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚ Ð½Ð° Ð½ÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½ÑƒÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ
            $response = "ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð¯ Ð±Ð¾Ñ‚ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸. ðŸ’–\n"
                . "Ð¢Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð¿Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ ÑÐ¾ Ð¼Ð½Ð¾Ð¹, Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¾Ð²ÐµÑ‚ Ð¸Ð»Ð¸ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ÑƒÑÐ¿Ð¾ÐºÐ¾ÐµÐ½Ð¸Ñ.";
        }
        
        $data = [
            'chat_id' => $chat_id,
            'text'    => $response,
            'reply_markup' => $keyboard,
        ];
        
        return $this->replyToChat('', $data);
    }
}